---
import Modal from "./ui/Modal.astro";

type Project = {
  title: string;
  description: string;
  tech?: string[];
  link?: string;
  image?: string;
  gallery?: string[];
};

const { project } = Astro.props as { project: Project };

const modalId = `proj-${project.title.replace(/[^a-z0-9]+/gi, "-").toLowerCase()}`;
const hasGallery = (project.gallery?.length ?? 0) > 0;
---

<article
  class="group overflow-hidden rounded-xl border border-slate-200 bg-white
         transition-all duration-300 ease-out
         hover:-translate-y-1 hover:shadow-xl hover:shadow-black/10
         dark:border-slate-800 dark:bg-slate-950 dark:hover:shadow-black/30"
>
  {project.image && (
    <div class="relative">
      <img
        src={project.image}
        alt={`Vista del proyecto ${project.title}`}
        class="h-44 w-full object-cover
               transition-transform duration-300 ease-out
               group-hover:scale-[1.03]"
        loading="lazy"
      />

      <div
        class="pointer-events-none absolute inset-0
               bg-gradient-to-t from-black/55 via-black/10 to-transparent
               opacity-0 transition-opacity duration-300 ease-out
               group-hover:opacity-100"
      ></div>

      <div class="absolute right-3 top-3 flex gap-2">
        {project.link && (
          <a
            href={project.link}
            target="_blank"
            rel="noreferrer"
            title="Abrir proyecto"
            aria-label="Abrir proyecto"
            class="inline-flex h-10 w-10 items-center justify-center rounded-lg
                   bg-white/90 text-slate-900 backdrop-blur
                   opacity-0 translate-y-1
                   transition-all duration-200 ease-out
                   group-hover:opacity-100 group-hover:translate-y-0
                   hover:scale-105 active:scale-95"
          >
            üîó
          </a>
        )}

        {hasGallery && (
          <>
            <button
              type="button"
              title="Ver im√°genes"
              aria-label="Ver im√°genes del proyecto"
              class="inline-flex h-10 w-10 items-center justify-center rounded-lg
                     bg-white/90 text-slate-900 backdrop-blur
                     opacity-0 translate-y-1
                     transition-all duration-200 ease-out
                     group-hover:opacity-100 group-hover:translate-y-0
                     hover:scale-105 active:scale-95"
              onclick={`document.getElementById('${modalId}')?.showModal()`}
            >
              üëÅÔ∏è
            </button>

            <Modal id={modalId} title={project.title}>
            <div class="space-y-4">
              <p class="mt-2 text-sm text-slate-400 dark:text-slate-600">
                {project.description}
              </p>

              <img
                id={`${modalId}-main`}
                src={project.gallery?.[0]}
                alt={`Vista principal del proyecto ${project.title}`}
                class="w-full rounded-lg border border-slate-200 dark:border-slate-800"
                loading="lazy"
              />

              <div class="flex gap-2 overflow-x-auto pb-1">
                {project.gallery?.map((img: string, idx: number) => (
                  <button
                    type="button"
                    class={`shrink-0 rounded-lg border transition
                          ${idx === 0 ? "border-slate-900 dark:border-white" : "border-slate-200 dark:border-slate-800"}
                          hover:opacity-90`}
                    onclick={`(() => {
                      const main = document.getElementById('${modalId}-main');
                      if (main) main.setAttribute('src', '${img}');
                    })()`}
                    title="Ver imagen"
                    aria-label="Ver imagen"
                  >
                    <img
                      src={img}
                      alt={`Miniatura ${idx + 1} del proyecto ${project.title}`}
                      class="h-16 w-24 rounded-lg object-cover"
                      loading="lazy"
                    />
                  </button>
                ))}
              </div>

              {project.link && (
                <a
                  href={project.link}
                  target="_blank"
                  rel="noreferrer"
                  class="inline-flex items-center gap-2 text-sm font-medium underline underline-offset-4
                        text-slate-900 hover:opacity-80 dark:text-slate-100"
                >
                  Abrir proyecto <span aria-hidden="true">‚Üí</span>
                </a>
              )}
            </div>
          </Modal>
          </>
        )}
      </div>
    </div>
  )}

  <div class="p-5">
    <h3 class="font-semibold tracking-tight">{project.title}</h3>

    <p class="mt-2 text-sm text-slate-600 dark:text-slate-300">
      {project.description}
    </p>

    <div class="mt-3 flex flex-wrap gap-2">
      {project.tech?.map((t: string) => (
        <span
          class="rounded-full bg-slate-100 px-2 py-1 text-xs text-slate-700
                 transition-all duration-200 ease-out
                 hover:-translate-y-0.5 hover:bg-slate-200
                 dark:bg-slate-900 dark:text-slate-200 dark:border dark:border-slate-800
                 dark:hover:bg-slate-800"
        >
          {t}
        </span>
      ))}
    </div>

    {project.link && (
      <a
        href={project.link}
        target="_blank"
        rel="noreferrer"
        class="mt-4 inline-flex items-center gap-2 text-sm font-medium
               underline underline-offset-4
               text-slate-900 transition-opacity duration-200 ease-out
               hover:opacity-80 dark:text-slate-100"
      >
        Ver proyecto <span aria-hidden="true">‚Üí</span>
      </a>
    )}
  </div>
</article>
